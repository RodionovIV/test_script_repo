# Системные требования для LLM-агентской системы

## 1. Знакомство с бизнес-контекстом и бизнес-требованиями, их уточнение

**Бизнес-домен:** Образовательная платформа для изучения иностранных языков.

**Ключевые бизнес-цели и задачи:**
- Повышение качества переводов и объяснений грамматики.
- Улучшение навыков произношения пользователей.
- Увеличение числа пользователей и повышение их удовлетворенности.
- Повышение репутации компании и увеличение доходов.

**Проблемы, существующие в текущем процессе:**
- Низкое качество переводов и объяснений грамматики.
- Недостаток персонализированных упражнений и заданий.
- Сложности с тренировкой произношения.

**Как агент может решить эти проблемы:**
- Использование LLM-агентов для качественного перевода и объяснения грамматики.
- Предоставление персонализированных упражнений и заданий для тренировки произношения.
- Интеграция с внешними системами для повышения удобства и эффективности обучения.

**Метрики и KPI для оценки эффективности агента:**
- Количество пользователей, прошедших обучение.
- Уровень удовлетворенности пользователей.
- Количество выполненных упражнений и заданий.
- Время, затраченное на обучение.

---

## 2. Определение ролей пользователей и приложений. Верхнеуровневое проектирование архитектуры

### Определение ролей пользователей и приложений

**Роли пользователей и приложений:**
- **Пользователи**: конечные пользователи системы, изучающие иностранные языки.
- **Разработчики**: команда, ответственная за разработку и тестирование системы.
- **Менеджеры проекта**: ответственные за управление проектом и его реализацию.
- **Бизнес-аналитики**: ответственные за анализ и проектирование архитектуры системы.
- **Маркетологи**: ответственные за продвижение и маркетинг системы.

**Примеры запросов от пользователей:**
- Перевод текста с одного языка на другой.
- Объяснение грамматических конструкций.
- Тренировка произношения.

### Верхнеуровневое проектирование архитектуры

**Компоненты архитектуры и их назначение:**
- **Агент-переводчик**: отвечает за перевод текста, объяснение грамматики и помощь в понимании контекста.
- **Агент-тренер**: помогает пользователю тренировать произношение, предоставляет упражнения и задания.
- **Агент-оркестратор**: координирует работу других агентов, распределяет задачи и обеспечивает взаимодействие между ними.

**Взаимодействия между компонентами:**
- Пользовательский запрос поступает в систему через UI.
- Агент-оркестратор получает запрос и распределяет задачи между агентами.
- Агент-переводчик выполняет перевод, используя RAG и Web Search.
- Агент-тренер предоставляет упражнения и задания для тренировки произношения.
- Агент-оркестратор собирает результаты работы агентов и передает их в пользовательский интерфейс.

**Технологии и библиотеки:**
- **LangChain**: для управления инструментами и взаимодействия с внешними системами.
- **FastAPI**: для реализации API.
- **Arize Phoenix**: для мониторинга и анализа производительности.

---

## 3. Выделение и описание основных сценариев работы с системой

**Сценарии работы с системой:**

### Сценарий 1: Перевод текста

**Название сценария:** Перевод текста.

**Участвующие роли:** Пользователь, Агент-переводчик, Агент-оркестратор.

**Описание сценария:**
1. Пользователь вводит текст для перевода через UI.
2. Агент-оркестратор получает запрос и направляет его агенту-переводчику.
3. Агент-переводчик выполняет перевод, используя RAG и Web Search.
4. Агент-оркестратор собирает результат и передает его в пользовательский интерфейс.

**Инструменты и внешние системы:** RAG, Web Search, API сторонних сервисов для перевода и грамматического анализа.

### Сценарий 2: Тренировка произношения

**Название сценария:** Тренировка произношения.

**Участвующие роли:** Пользователь, Агент-тренер, Агент-оркестратор.

**Описание сценария:**
1. Пользователь запрашивает тренировку произношения через UI.
2. Агент-оркестратор получает запрос и направляет его агенту-тренеру.
3. Агент-тренер предоставляет упражнения и задания для тренировки произношения.
4. Агент-оркестратор собирает результат и передает его в пользовательский интерфейс.

**Инструменты и внешние системы:** API сторонних сервисов для анализа произношения и генерации упражнений.

---

## 4. Проработка альтернативных сценариев

**Типичные ошибки и нештатные ситуации:**
- Ошибки подключения к внешним системам (API, БД).
- Ошибки формата или содержания пользовательских запросов.
- Таймауты, ошибки выполнения кода, сбои в LangChain.

**Поведение системы при таких ошибках:**
- При ошибке подключения к внешним системам: повтор запроса, fallback на альтернативный источник, сообщение об ошибке.
- При ошибке формата или содержания запроса: сообщение об ошибке с указанием причины.
- При таймауте или сбое в LangChain: повтор запроса, fallback на альтернативный инструмент, сообщение об ошибке.

**Логирование ошибок:**
- Все ошибки логируются в систему мониторинга (Arize Phoenix).
- Сообщения об ошибках передаются пользователю через UI.

---

## 5. Требования к безопасности

**Аутентификация и авторизация:**
- Аутентификация осуществляется через OAuth2 или JWT.
- Авторизация: роли пользователей определяют доступ к функциям и инструментам.

**Хранение секретов:**
- Секреты (токены к API) хранятся в защищенном хранилище с соблюдением best practices.

**Защита данных:**
- Конфиденциальные данные шифруются при передаче и хранении.
- Соблюдаются стандарты GDPR и ISO 27001.

---

## 6. Описание нефункциональных требований

**Производительность:**
- Среднее число запросов: 1000 запросов в минуту.
- Пиковое число запросов: 5000 запросов в минуту.
- Время отклика: менее 1 секунды.

**Масштабируемость:**
- Горизонтальное масштабирование через контейнеризацию.
- Вертикальное масштабирование через увеличение ресурсов сервера.

**Доступность:**
- 99.9% uptime.

**Логирование и аудит:**
- Логирование всех запросов и ответов.
- Аудит доступа к конфиденциальным данным.

**Трассировка:**
- Сбор данных о производительности и ошибках через Arize Phoenix.

**Восстановление после отказа:**
- Автоматическое восстановление при сбое LLM, инструментов, Backend.

---

## 7. Определение ключевых данных: сущности и их свойства

**Бизнес-сущности:**
- **Task**: задание или упражнение для пользователя.
  - Назначение: хранение информации о задании.
  - Основные свойства: id, name, description, created_at.
- **Request**: запрос пользователя.
  - Назначение: хранение информации о запросах.
  - Основные свойства: id, user_id, content, created_at.
- **ToolInvocation**: вызов инструмента.
  - Назначение: хранение информации о вызовах инструментов.
  - Основные свойства: id, tool_name, input, output, created_at.
- **UserSession**: сессия пользователя.
  - Назначение: хранение информации о сессиях.
  - Основные свойства: id, user_id, start_time, end_time.

**Взаимосвязи между сущностями:**
- Один пользователь → много запросов.
- Один запрос → много вызовов инструментов.

---

## 8. Задачи на разработку инструментов для взаимодействия с внешними системами

**Инструменты для взаимодействия с внешними системами:**

### Инструмент 1: Переводчик

**Назначение:** перевод текста с одного языка на другой.

**Входные параметры:** текст для перевода, исходный язык, целевой язык.

**Выходные данные:** переведенный текст.

**Обработка ошибок:** повтор запроса, fallback на альтернативный источник, сообщение об ошибке.

**Формат данных:** JSON.

### Инструмент 2: Грамматический анализатор

**Назначение:** анализ грамматических конструкций.

**Входные параметры:** текст для анализа.

**Выходные данные:** объяснение грамматических конструкций.

**Обработка ошибок:** повтор запроса, fallback на альтернативный источник, сообщение об ошибке.

**Формат данных:** JSON.

### Инструмент 3: Анализ произношения

**Назначение:** анализ произношения пользователя.

**Входные параметры:** аудиозапись произношения.

**Выходные данные:** оценка произношения, рекомендации по улучшению.

**Обработка ошибок:** повтор запроса, fallback на альтернативный инструмент, сообщение об ошибке.

**Формат данных:** JSON.

---

## 9. Задачи на разработку методов Backend (методов API)

**Методы API:**

### Метод 1: Перевод текста

**Название и URL endpoint:** `/translate`

**Метод:** POST

**Входные параметры:**
- `text`: текст для перевода.
- `source_language`: исходный язык.
- `target_language`: целевой язык.

**Выходные данные:**
- `translated_text`: переведенный текст.

**Возможные коды ошибок:**
- 400: неверный формат запроса.
- 500: ошибка сервера.

### Метод 2: Анализ грамматики

**Название и URL endpoint:** `/analyze_grammar`

**Метод:** POST

**Входные параметры:**
- `text`: текст для анализа.

**Выходные данные:**
- `analysis`: объяснение грамматических конструкций.

**Возможные коды ошибок:**
- 400: неверный формат запроса.
- 500: ошибка сервера.

### Метод 3: Анализ произношения

**Название и URL endpoint:** `/analyze_pronunciation`

**Метод:** POST

**Входные параметры:**
- `audio`: аудиозапись произношения.

**Выходные данные:**
- `evaluation`: оценка произношения.
- `recommendations`: рекомендации по улучшению.

**Возможные коды ошибок:**
- 400: неверный формат запроса.
- 500: ошибка сервера.

---

## 10. Тестирование функционала

**Сценарии тестирования:**
- Основные сценарии: перевод текста, анализ грамматики, анализ произношения.
- Альтернативные сценарии: ошибки подключения к внешним системам, ошибки формата запроса, таймауты.

**Средства тестирования:**
- **pytest**: для модульного и интеграционного тестирования.
- **Postman**: для тестирования API.

**Параметры нагрузочного тестирования:**
- Среднее число запросов: 1000 запросов в минуту.
- Пиковое число запросов: 5000 запросов в минуту.

**Проверка безопасности:**
- Тесты аутентификации и авторизации.
- Проверка попыток несанкционированного доступа.

**Проверка трассировки и логирования:**
- Проверка сбора данных о производительности и ошибках через Arize Phoenix.

---

## Вопросы:
- Вопрос: Какие внешние системы необходимо интегрировать с системой?
- Вопрос: Каковы требования к скорости ответа для API-запросов?