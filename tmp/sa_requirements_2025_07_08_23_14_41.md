# Системные требования к проекту прогнозирования теннисных матчей

## 1. Знакомство с бизнес-контекстом и бизнес-требованиями, их уточнение

### Бизнес-домен
Система прогнозирования теннисных матчей предназначена для использования в сфере спортивных ставок и аналитики. Она будет интегрирована с веб-приложениями, мобильными приложениями и внешними системами (например, букмекерскими конторами), предоставляя точные и своевременные прогнозы исходов матчей.

### Бизнес-цели и задачи
- Повышение точности прогнозов на 20% за счет использования современных методов анализа данных.
- Сокращение времени обработки запросов на 50%, что улучшит пользовательский опыт.
- Увеличение доходов компании на 15% за счет более точных коэффициентов и привлечения новых клиентов.

### Проблемы текущего процесса
- Низкая точность прогнозов из-за устаревших методов анализа данных.
- Медленная обработка запросов, что приводит к задержкам в предоставлении прогнозов.
- Отсутствие интеграции с внешними источниками данных, такими как рейтинги игроков и статистика матчей.

### Метрики и KPI
- Точность прогнозов: не менее 80%.
- Время обработки запросов: не более 1 секунды.
- Интеграция с внешними источниками данных и пользовательскими приложениями.

## 2. Определение ролей пользователей и приложений. Верхнеуровневое проектирование архитектуры

### Роли пользователей и приложений
- **Пользователи**: конечные пользователи системы прогнозирования, включая игроков и болельщиков.
- **Букмекерские конторы**: внешние системы, использующие прогнозы для формирования коэффициентов.
- **Агент-аналитик**: отвечает за сбор и анализ данных, прогнозирование исхода матча.
- **Агент-координатор**: отвечает за взаимодействие с внешними системами, обработку запросов и передачу результатов.

### Архитектура системы
Система состоит из двух основных компонентов:
- **Агент-аналитик**: использует инструменты RAG и Web Search для сбора и анализа данных, прогнозирования исхода матча.
- **Агент-координатор**: использует инструмент API для взаимодействия с внешними сервисами и передачи результатов.

### Взаимодействие между компонентами
- Пользователь или внешняя система отправляет запрос на прогноз матча через веб-приложение или API.
- Агент-координатор получает запрос и передает его агенту-аналитику.
- Агент-аналитик собирает и анализирует данные, прогнозирует исход матча.
- Агент-аналитик передает прогноз агенту-координатору.
- Агент-координатор передает результат пользователю через веб-приложение или внешней системе через API.

### Технологии и библиотеки
- **LangChain**: для обработки и анализа данных.
- **FastAPI**: для реализации API.
- **Arize Phoenix**: для мониторинга и анализа производительности.

## 3. Выделение и описание основных сценариев работы с системой

### Сценарий 1: Запрос прогноза матча
- **Инициатор**: Пользователь или внешняя система.
- **Действия**:
  1. Пользователь или внешняя система отправляет запрос на прогноз матча.
  2. Агент-координатор получает запрос и передает его агенту-аналитику.
  3. Агент-аналитик собирает и анализирует данные, прогнозирует исход матча.
  4. Агент-аналитик передает прогноз агенту-координатору.
  5. Агент-координатор передает результат пользователю или внешней системе.
- **Инструменты**: API, RAG, Web Search.

### Сценарий 2: Обновление данных
- **Инициатор**: Агент-аналитик.
- **Действия**:
  1. Агент-аналитик периодически обновляет данные о матчах, игроках и рейтингах.
  2. Данные сохраняются в базе данных.
- **Инструменты**: RAG, Web Search.

## 4. Проработка альтернативных сценариев

### Ошибки и нештатные ситуации
- **Ошибка подключения к внешним системам**: агент-координатор возвращает сообщение об ошибке пользователю или внешней системе.
- **Ошибка формата или содержания запроса**: агент-координатор возвращает сообщение об ошибке с указанием причины.
- **Таймаут**: агент-координатор возвращает сообщение об ошибке с указанием причины.
- **Ошибка выполнения кода**: агент-координатор возвращает сообщение об ошибке с указанием причины.

### Обработка ошибок
- **Логирование**: все ошибки логируются в системе.
- **Сообщение об ошибке**: пользователь или внешняя система получают сообщение с указанием причины ошибки.

## 5. Требования к безопасности

### Аутентификация и авторизация
- **Аутентификация**: JWT.
- **Авторизация**: роли пользователей и внешних систем имеют доступ к соответствующим функциям и инструментам.

### Защита данных
- **Шифрование**: данные передаются и хранятся в зашифрованном виде.
- **Конфиденциальные данные**: рейтинги игроков, статистика матчей.

### Стандарты
- **GDPR**: для защиты персональных данных пользователей.
- **ISO 27001**: для обеспечения информационной безопасности.

## 6. Описание нефункциональных требований

### Производительность
- **Среднее число запросов**: 100 запросов в секунду.
- **Пиковое число запросов**: 500 запросов в секунду.
- **Время отклика**: не более 1 секунды.

### Масштабируемость
- **Горизонтальное масштабирование**: использование контейнеров и оркестратора (например, Kubernetes).
- **Вертикальное масштабирование**: увеличение ресурсов сервера при необходимости.

### Доступность
- **Uptime**: 99.9%.

### Логирование и аудит
- **Логирование**: все действия и ошибки логируются.
- **Аудит**: журналы аудита доступны для анализа.

### Трассировка
- **Arize Phoenix**: используется для мониторинга и анализа производительности.

### Восстановление после отказа
- **LLM**: при сбое LLM используется fallback-ответ.
- **Backend**: при сбое Backend используется резервный сервер.

## 7. Определение ключевых данных: сущности и их свойства

### Бизнес-сущности
- **Task**: задача прогнозирования матча.
  - **id**: уникальный идентификатор задачи.
  - **status**: статус задачи (в обработке, завершена).
  - **created_at**: дата создания задачи.
- **Request**: запрос на прогноз матча.
  - **id**: уникальный идентификатор запроса.
  - **user_id**: идентификатор пользователя.
  - **match_id**: идентификатор матча.
  - **created_at**: дата создания запроса.
- **ToolInvocation**: вызов инструмента для анализа данных.
  - **id**: уникальный идентификатор вызова.
  - **task_id**: идентификатор задачи.
  - **tool_name**: название инструмента.
  - **created_at**: дата вызова инструмента.

## 8. Задачи на разработку инструментов для взаимодействия с внешними системами

### Инструменты
- **RAG**: для сбора и анализа данных.
- **Web Search**: для поиска данных в интернете.
- **API**: для взаимодействия с внешними системами.

### Описание инструментов
- **RAG**:
  - **Назначение**: сбор и анализ данных.
  - **Входные параметры**: запрос на анализ данных.
  - **Выходные данные**: анализированные данные.
  - **Обработка ошибок**: логирование ошибок, возврат сообщения об ошибке.
- **Web Search**:
  - **Назначение**: поиск данных в интернете.
  - **Входные параметры**: запрос на поиск данных.
  - **Выходные данные**: найденные данные.
  - **Обработка ошибок**: логирование ошибок, возврат сообщения об ошибке.
- **API**:
  - **Назначение**: взаимодействие с внешними системами.
  - **Входные параметры**: запрос на прогноз матча.
  - **Выходные данные**: прогноз матча.
  - **Обработка ошибок**: логирование ошибок, возврат сообщения об ошибке.

## 9. Задачи на разработку методов Backend (методов API)

### Методы API
- **GET /matches**: получение списка матчей.
  - **Входные параметры**: нет.
  - **Выходные данные**: список матчей.
- **POST /predict**: прогнозирование исхода матча.
  - **Входные параметры**: идентификатор матча.
  - **Выходные данные**: прогноз исхода матча.
- **GET /users**: получение списка пользователей.
  - **Входные параметры**: нет.
  - **Выходные данные**: список пользователей.

### Описание методов
- **GET /matches**:
  - **Метод**: GET.
  - **Входные параметры**: нет.
  - **Выходные данные**: список матчей.
  - **Коды ошибок**: 404 (матч не найден), 500 (внутренняя ошибка).
- **POST /predict**:
  - **Метод**: POST.
  - **Входные параметры**: идентификатор матча.
  - **Выходные данные**: прогноз исхода матча.
  - **Коды ошибок**: 400 (неверный запрос), 404 (матч не найден), 500 (внутренняя ошибка).
- **GET /users**:
  - **Метод**: GET.
  - **Входные параметры**: нет.
  - **Выходные данные**: список пользователей.
  - **Коды ошибок**: 404 (пользователь не найден), 500 (внутренняя ошибка).

## 10. Тестирование функционала

### Тестирование
- **Сценарии**: основные и альтернативные сценарии работы с системой.
- **Инструменты**: pytest, Postman.
- **Параметры**: точность прогнозов, время обработки запросов.
- **Безопасность**: тесты аутентификации, попытки несанкционированного доступа.
- **Трассировка**: проверка логирования и мониторинга в Arize Phoenix.

---

## Вопросы
- Вопрос: Какие внешние системы необходимо интегрировать с системой?
- Вопрос: Каковы требования к скорости ответа для API-запросов?